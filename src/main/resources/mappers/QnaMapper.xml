<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="qna">

    <!--전체 QnA 목록-->
    <select id="qnaList" resultType="kr.co.teaspoon.dto.Qna">
        SELECT a.qno AS qno, a.title AS title, a.content AS content, a.author AS author, a.resdate AS resdate, a.visited as visited, a.lev AS lev, a.par AS par, b.name AS NAME FROM qna a, member b WHERE a.author=b.id order BY a.par DESC, a.lev ASC, a.qno ASC
    </select>

    <!--답변없는 질문 목록-->
    <select id="answerList" resultType="kr.co.teaspoon.dto.Qna">
        select qno, title, name, q.resdate from qna q join member m on(q.author=m.id) where par in (select par from qna group by par having count(par) &gt; 2)
    </select>

    <!--상세보기-->
    <select id="qnaDetail" resultType="kr.co.teaspoon.dto.Qna">
        select * from qna where qno=#{qno}
    </select>

    <!--질문 상세보기-->
    <select id="questionDetail" resultType="kr.co.teaspoon.dto.Qna">
        select * from qna where par=#{par} and lev=0
    </select>

    <!--답변 상세보기-->
    <select id="answerDetail" resultType="kr.co.teaspoon.dto.Qna">
        select * from qna where par=#{par} and lev=1
    </select>

    <!--QnA 글 카운트-->
    <select id="totalQna" resultType="integer">
        select count(*) from qna
    </select>

    <!--질문 글 카운트-->
    <select id="totalQuestion" resultType="integer">
        select count(*) from qna where lev=0
    </select>

    <!--답변 글 카운트-->
    <select id="totalAnswer" resultType="integer">
        select count(*) from qna where lev=1
    </select>

    <!--글 조회수-->
    <update id="visited">
        update qna set visited=visited+1 where qno=#{qno}
    </update>

    <!--질문 글 등록-->
    <insert id="questionInsert">
        insert into qna values (default, #{title}, #{content}, #{author}, default, default, 0, #{par})
    </insert>

    <!-- par = qno-->
    <update id="parUpdate">
        update qna set par=qno where par=0 and lev=0
    </update>

    <!--답변 글 등록-->
    <insert id="answerInsert">
        insert into qna values (default, #{title}, #{content}, #{author}, default, default, 1, #{par})
    </insert>

    <!-- 글 수정-->
    <update id="qnaUpdate">
        update free set title=#{title}, content=#{content} where qno=#{qno}
    </update>

    <!--질문 글 삭제-->
    <delete id="qnaDelete">
        delete from free where qno=#{qno}
    </delete>

</mapper>